!function(e){var t={};function a(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(s,i,function(t){return e[t]}.bind(null,i));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=3)}([function(e,t){e.exports=require("firebase-admin")},function(e,t){t.getDate=(()=>{var e=new Date;return e=e.getDate()+"th "+["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]+" "+e.getFullYear()})},function(e,t,a){const s=a(0),i=a(1),n=s.firestore();t.create=(()=>{let e={country:"",city:"",address:"",mobile:"",email:"",create_at:i.getDate(),update_at:i.getDate()};var t=n.collection("billinginfos").doc();return e.id=t.id,new Promise(function(a,s){t.set(e).then(t=>{a(e)}).catch(e=>{s(e)})})}),t.findAll=((e,t)=>{n.collection("billinginfos").get().then(e=>{let a=[];e.forEach(e=>{a.push(e.data())}),t.json(a)}).catch(e=>t.status(500).send({message:e.message||"Something wrong while retrieving billinginfos."}))}),t.findOne=((e,t)=>{if(!e.body)return t.status(400).send({message:"BillingInfo content can not be empty"});n.collection("billinginfos").doc(e.params.id).get().then(e=>{let a=e.data();t.json(a)}).catch(e=>t.status(500).send({message:e.message||"Something wrong while retrieving billinginfo with id."}))}),t.update2=((e,t)=>{if(!e.body)return t.status(400).send({message:"BillingInfo content can not be empty"});let a=e.body;a.password=bcrypt.hashSync(a.password,10),n.collection("billinginfos").doc(e.params.id).update(a).then(a=>{if(!a)return t.status(404).send({message:"BillingInfo not found with id "+e.params.id});t.send({message:"BillingInfo updated successfully!"})}).catch(a=>t.status(500).send({message:a.message||"Could not delete billinginfo with id "+e.params.id}))}),t.update=((e,t)=>{if(!e.body)return t.status(400).send({message:"BillingInfo content can not be empty"});let a={};a[e.body.fname]=e.body.fvalue,n.collection("billinginfos").doc(e.params.id).update(a).then(a=>{if(!a)return t.status(404).send({message:"BillingInfo not found with id "+e.params.id});t.send({message:"BillingInfo updated successfully!"})}).catch(a=>t.status(500).send({message:a.message||"Could not delete billinginfo with id "+e.params.id}))}),t.delete=((e,t)=>{if(!e.body)return t.status(400).send({message:"BillingInfo content can not be empty"});n.collection("billinginfos").doc(e.params.id).delete().then(a=>{if(!a)return t.status(404).send({message:"BillingInfo not found with id "+e.params.id});t.send({message:"BillingInfo deleted successfully!"})}).catch(a=>t.status(500).send({message:a.message||"Could not delete billinginfo with id "+e.params.id}))})},function(e,t,a){e.exports=a(4)},function(e,t,a){const s=a(5),i=a(6),n=a(7),o=s();o.use(i.urlencoded({extended:!1})),o.use(i.json()),o.use(function(e,t,a){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Methods","GET, PUT, POST, DELETE, OPTIONS"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),a()}),o.use(n()),o.get("/",(e,t)=>{t.json("WELCOME BUYANYCARONLINE")}),o.listen(3e3,()=>{console.log("Server is listening on port 3000")}),o.use(s.static("public"));var d=a(0),c=a(8);d.initializeApp({credential:d.credential.cert(c),databaseURL:"https://anycaronline-8bf60.firebaseio.com"}),a(9)(o),a(14)(o),a(15)(o),a(17)(o),a(19)(o),a(23)(o),a(25)(o)},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express-fileupload")},function(e){e.exports={type:"service_account",project_id:"anycaronline-8bf60",private_key_id:"e8c4cb1ef5e274b25ca55e2455ce97228035ecd3",private_key:"-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDDfyxrbV0zArto\n5nl5WnuX9Zkcn0X+nujroy3TNJtAgLnYWVkXoMHbbIi9EdE3IxU2VPaaCh0agluu\nteh/Zu07BbYkj8zSatIH+X0rTnreGhIdn2FpT68tkTesoAT8IvW7FAmsHYfHK8VA\nPIy8EZx9cwcOy7+ZYIaMP7wry9l2bld5hMkCwQwE055cgphVujdc7+f6zqXvUD4L\nSIZ+CbJVwU2Z+ZdNFRK0QDM79oiZTTVGEiZqbvsV225KP47S3+hNLkdaj9ZZGxjN\ntWjNcIFXtJiyJ4w5rwX5A+budUqWohqi8XEwCBx/JdGK700tf+OaNiawgqi9LyvB\ncMWchrqRAgMBAAECgf9HxfjyhKq8f6EU8jv6AbsLUm/UKLJZ7AQEZVrKbK+GQiLF\nyCFqO1FXOpGfi8Fz3/Cs8de+CT7shjXpMeZNLLMMAemaCSSTKNFtFa71Dbfhf7c6\nIoZw7RoAPY0v8DZKtP5JByJF8Z5X0T1De13WVK211CiGYudra05g6N7827c+P/K6\nrq8bzER8fbWjTP+YI4EFr8FC1vLag50OyzQ5kI2oJhLLWEmtMkQPPJo7MvEcOujV\nj5lArNcmyGiOi8iRYxLOPsBtr/tOFFuXHXTykiWvcTPdbqnXmhQ7paLFlzgxajHC\nnIkiRrTyfO51JkbNU3cLOxcfQNKwB2v0cXlRASECgYEA9UA4itkIDp9PbZhJ7ef2\nJQek/q4wrSgGh/lK54in2WNmhr2YJOxjwSQp2mG7r8cnHQGmQLnikiF1UgZGCCNV\nBAwTUccpyfGks3ljXDeby/zuj1QHkdHh7cxqowMmcC/q0gPq4S8O1vmhxmJ5RDJT\n2uCrruahLSQUu8PI6Ej7iPECgYEAzBCy29NcPhhO6w+1sJrPr7QA2mSik17mHGya\nrpp+Z3oyYfbaf7Mp7x3i50GpMuJdD51DQfROMNcw75cA32iRE99Ff4nTuHb1HkmI\nkP579kP088vdpScsD9+3r6kvNoJEyJqm1VYX1ktGefWLW4qAzIJlXZk2CPyMo9rA\nMrCnS6ECgYEAgHJGKtJIWgAuBWRBNAzM6c/7Jjfs3oOcCBMUm/cCkeRxihg6WvxD\nsqBSG0Icno9beOGoRTYV6BsF6xPGEfUPTbNVWvtIc6/PZwAofd/SBSBPgVmtLT4T\nagwpvX6k3xT5k0zh81ZGG2laxSBGCuWg7X3F7TB1McM36K89xgqTUsECgYEAgia4\nXNouf/AzDVskr7Hdepvc223J/yJMs55U/b3NlyPp1G+EJmRX/4lZOdO4HZsgbaAI\n0J0H7cCiFn2B8fuYZEtH4TM/1OwSJDIUJx4YZBYtufyxre8Q/ELcve2zDhoB0sxI\nUdKqO2QhXBHOwyDQSx9zlUHto8enz63qXaor2WECgYEA6cuNmKg7Uwv1vLK6QwfP\n+hoGTzrYQpn2JaLeCAzub6G4FRoyBLr52DnzZT2NstiFWitgx6JEC/p5KZ/PGQMf\nC03d1OOFYF/TyHvzgrA7BUeuht3RtNxxICYLVR6Mkpp9BiDC/CTSdGw7yYT5WySE\nmwP3m5uRimDtvFZK+JmpeXQ=\n-----END PRIVATE KEY-----\n",client_email:"firebase-adminsdk-uftbj@anycaronline-8bf60.iam.gserviceaccount.com",client_id:"115986796940509351963",auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://oauth2.googleapis.com/token",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs",client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-uftbj%40anycaronline-8bf60.iam.gserviceaccount.com"}},function(e,t,a){e.exports=(e=>{const t=a(10);e.post("/users",t.create),e.post("/users/authenticate",t.authenticate),e.get("/users",t.findAll),e.get("/users/:id",t.findOne),e.put("/users/:id",t.update),e.put("/users2/:id",t.update2),e.delete("/users/:id",t.delete)})},function(e,t,a){const s=a(0),i=a(11),n=a(12),o=a(13),d=a(1),c=s.firestore(),r=a(2);t.create=(async(e,t)=>{if(!e.body)return t.status(400).send({message:"User content can not be empty"});if(0!=(await c.collection("users").where("username","==",e.body.username).get())._size)return t.status(400).json({message:"Username already exists."});{let a=await r.create(),s={username:e.body.username,password:n.hashSync(e.body.password,10),billinginfo_id:a.id,message_id:"",type:"USER",create_at:d.getDate(),update_at:d.getDate()},l=c.collection("users").doc();s.id=l.id,l.set(s).then(e=>{const a=i.sign({sub:s.id},o.secret);s.token=a,t.json(s)}).catch(e=>t.status(500).json({message:e.message||"Something wrong while creating the user."}))}}),t.findAll=((e,t)=>{c.collection("users").get().then(e=>{let a=[];e.forEach(e=>{a.push(e.data())}),t.json(a)}).catch(e=>t.status(500).send({message:e.message||"Something wrong while retrieving users."}))}),t.findOne=((e,t)=>{if(!e.body)return t.status(400).send({message:"User content can not be empty"});c.collection("users").doc(e.params.id).get().then(e=>{let a=e.data();t.json(a)}).catch(e=>t.status(500).send({message:e.message||"Something wrong while retrieving user with id."}))}),t.findAllByUserName=(async(e,t)=>{let a;(await c.collection("users").where("username","==",e.body.username).get()).forEach(e=>{a=e.data(),t.json(a)})}),t.update2=((e,t)=>{if(!e.body)return t.status(400).send({message:"User content can not be empty"});let a=e.body;a.password=n.hashSync(a.password,10),c.collection("users").doc(e.params.id).update(a).then(a=>{if(!a)return t.status(404).send({message:"User not found with id "+e.params.id});t.send({message:"User updated successfully!"})}).catch(a=>t.status(500).send({message:a.message||"Could not update user with id "+e.params.id}))}),t.update=((e,t)=>{if(!e.body)return t.status(400).send({message:"User content can not be empty"});let a={};a[e.body.fname]=e.body.fvalue,"password"==e.body.fname&&(a[e.body.fname]=n.hashSync(e.body.fvalue,10)),c.collection("users").doc(e.params.id).update(a).then(a=>{if(!a)return t.status(404).send({message:"User not found with id "+e.params.id});t.send({message:"User updated successfully!"})}).catch(a=>t.status(500).send({message:a.message||"Could not update user with id "+e.params.id}))}),t.delete=((e,t)=>{if(!e.body)return t.status(400).send({message:"User content can not be empty"});c.collection("users").doc(e.params.id).delete().then(a=>{if(!a)return t.status(404).send({message:"User not found with id "+e.params.id});t.send({message:"User deleted successfully!"})}).catch(a=>t.status(500).send({message:a.message||"Could not delete user with id "+e.params.id}))}),t.authenticate=(async(e,t)=>{if(!e.body)return t.status(400).send({message:"User content can not be empty"});let a=e.body.username,s=e.body.password,d=!1;return await c.collection("users").where("username","==",a).get().then(e=>{e.forEach(e=>{d=!0;let a=e.data();if(a&&n.compareSync(s,a.password)){const e=i.sign({sub:a.id},o.secret);return a.token=e,t.json(a)}return t.status(400).send({message:"The password is incorrect."})})}).catch(e=>t.status(500).send({message:e.message||"Something wrong while retrieving users with name."})),d?void 0:t.status(400).send({message:"The username is incorrect."})})},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("bcryptjs")},function(e){e.exports={secret:"THIS IS USED TO SIGN AND VERIFY JWT TOKENS, REPLACE IT WITH YOUR OWN SECRET, IT CAN BE ANY STRING"}},function(e,t,a){e.exports=(e=>{const t=a(2);e.get("/billinginfos",t.findAll),e.get("/billinginfos/:id",t.findOne),e.put("/billinginfos/:id",t.update)})},function(e,t,a){e.exports=(e=>{const t=a(16);e.post("/ads",t.create),e.get("/ads",t.findAll),e.get("/ads/:id",t.findOne),e.get("/ads/userid/:user_id",t.findAllByUserId),e.put("/ads/:id",t.update),e.put("/ads/increase/:id",t.increaseVisitCount),e.delete("/ads/:id",t.delete)})},function(e,t,a){var s=a(0).firestore(),i=a(1);t.create=((e,t)=>{let a={user_id:e.body.user_id,title:e.body.title,price:e.body.price,description:e.body.description,city:e.body.city,no:e.body.no,approve:e.body.approve,publish:e.body.publish,visitcount:e.body.visitcount,create_at:i.getDate(),update_at:i.getDate()};var n=s.collection("ads").doc();a.id=n.id,n.set(a).then(e=>{t.json(a)}).catch(e=>t.status(500).json({message:e.message||"Something wrong while creating the ad."}))}),t.findAll=(async(e,t)=>{let a=[];(await s.collection("ads").get()).forEach(e=>{ad=e.data(),a.push(ad)}),t.json(a)}),t.findOne=(async(e,t)=>{(await s.collection("ads").where("id","==",e.params.id).get()).forEach(e=>{ad=e.data(),t.json(ad)})}),t.findAllByUserId=(async(e,t)=>{let a=[];(await s.collection("ads").where("user_id","==",e.params.user_id).get()).forEach(e=>{ad=e.data(),a.push(ad)}),t.json(a)}),t.update=((e,t)=>{if(e.params.id){var a={};return a[e.body.fname]=e.body.fvalue,(i=s.collection("ads").doc(e.params.id)).update(a),t.send({message:"Ad updated successfully!"})}var i=s.collection("ads").doc();a.id=i.id,i.set(a)}),t.increaseVisitCount=(async(e,t)=>{const a=await s.collection("ads").where("id","==",e.params.id).get();var i={};a.forEach(a=>{return(i=a.data()).visitcount=i.visitcount+1,s.collection("ads").doc(e.params.id).update(i),t.send({status:"success",message:"Ad's visit count increased successfully!",visitcount:i.visitcount})})}),t.delete=((e,t)=>{s.collection("ads").doc(e.params.id).delete().then(a=>a?t.send({message:"Ad deleted successfully!"}):t.status(404).send({message:"Ad not found with id "+e.params.id})).catch(a=>"ObjectId"===a.kind||"NotFound"===a.name?t.status(404).send({message:"Ad not found with id "+e.params.id}):t.status(500).send({message:"Could not delete ad with id "+e.params.id}))})},function(e,t,a){e.exports=(e=>{const t=a(18);e.post("/vehicles",t.create),e.get("/vehicles",t.findAll),e.get("/vehicles/:id",t.findOne),e.put("/vehicles/:id",t.update),e.delete("/vehicles/:id",t.delete),e.delete("/vehicles/ad/:id",t.deleteByAdId)})},function(e,t,a){var s=a(0).firestore(),i=a(1);t.create=((e,t)=>{let a={ad_id:e.body.ad_id,make_id:e.body.make_id,model_id:e.body.model_id,warrenty:e.body.warrenty,cylinders:e.body.cylinders,condition:e.body.condition,year:e.body.year,fueltype:e.body.fueltype,create_at:i.getDate(),update_at:i.getDate()};var n=s.collection("vehicles").doc();a.id=n.id,n.set(a).then(e=>{t.json(a)}).catch(e=>t.status(500).json({message:e.message||"Something wrong while creating the vehicle."}))}),t.findAll=(async(e,t)=>{let a=[];(await s.collection("vehicles").get()).forEach(e=>{vehicle=e.data(),a.push(vehicle)}),t.json(a)}),t.findOne=(async(e,t)=>{(await s.collection("vehicles").where("id","==",e.params.id).get()).forEach(e=>{vehicle=e.data(),t.json(vehicle)})}),t.update=((e,t)=>{if(e.params.id){var a={};a[e.body.fname]=e.body.fvalue,(i=s.collection("vehicles").doc(e.params.id)).update(a)}else{var i=s.collection("vehicles").doc();a.id=i.id,i.set(a)}}),t.delete=((e,t)=>{s.collection("vehicles").doc(e.params.id).delete().then(a=>{if(!a)return t.status(404).send({message:"Vehicle not found with id "+e.params.id});t.send({message:"Vehicle deleted successfully!"})}).catch(a=>"ObjectId"===a.kind||"NotFound"===a.name?t.status(404).send({message:"Vehicle not found with id "+e.params.id}):t.status(500).send({message:"Could not delete vehicle with id "+e.params.id}))}),t.deleteByAdId=((e,t)=>{s.collection("vehicles").where("ad_id","==",e.params.id).get().then(a=>{if(!a)return t.status(404).send({message:"Vehicle not found with id "+e.params.id});a.forEach(function(e){var a=e.data().id;e.ref.delete().then(e=>{t.send({message:"Vehicle deleted successfully!",status:"Success",id:a})})})}).catch(a=>"ObjectId"===a.kind||"NotFound"===a.name?t.status(404).send({message:"Vehicle not found with id "+e.params.id}):t.status(500).send({message:"Could not delete vehicle with id "+e.params.id}))})},function(e,t,a){e.exports=(e=>{const t=a(20);e.post("/cars",t.create),e.get("/cars",t.findAll),e.get("/cars/:id",t.findOne),e.get("/cars/ad/:id",t.findOneByAdId),e.get("/cars/alone/:id",t.findAloneOne),e.post("/cars/search",t.findAllOnSearch),e.post("/cars/search-index",t.findAllOnIndex),e.put("/cars/:id",t.update),e.put("/cars/img/:id",t.updateImage),e.delete("/cars/vehicle/:id",t.deleteByVehicleId),e.post("/cars/upload/:car_id",t.upload)})},function(e,t,a){const s=a(0).firestore(),i=a(21),n=a(1),o=a(22);async function d(e,t,a){let i=e.body.make,n=e.body.model,o=Number(e.body.fromPrice),d=Number(e.body.toPrice),c=Number(e.body.fromYear),r=Number(e.body.toYear),l=[],u=[];a.forEach(function(e){u.push(e)});for(const e of u){let t=e.data(),a={};Object.assign(a,t);let u=await s.collection("vehicles").where("ad_id","==",t.id).get(),m=[];u.forEach(function(e){m.push(e)});for(const e of m){let t=e.data();Object.assign(a,t),await Promise.all([s.collection("cars").where("vehicle_id","==",t.id).get(),s.collection("makes").where("id","==",t.make_id).get(),s.collection("models").where("id","==",t.model_id).get()]).then(function(e){e[0].forEach(e=>{Object.assign(a,e.data())}),e[1].forEach(e=>{a.make=e.data().value}),e[2].forEach(e=>{a.model=e.data().modelvalue}),(""==i||i==a.make_id)&&(""==n||n==a.model_id)&&(""==o||o<=a.price)&&(""==d||d>=a.price)&&(""==c||c<=a.year)&&(""==r||r>=a.year)&&"true"==a.publish&&l.push(a)})}}t.json(l)}async function c(e,t,a){let i=e.body.make,n=e.body.model,o=Number(e.body.fromPrice),d=Number(e.body.toPrice),c=Number(e.body.fromYear),r=Number(e.body.toYear),l=[],u=[];a.forEach(function(e){u.push(e)});for(const e of u){let t=e.data(),a={};Object.assign(a,t);let u=await s.collection("cars").where("vehicle_id","==",t.id).get(),m=[];u.forEach(function(e){m.push(e)});for(const e of m)Object.assign(a,e.data()),await Promise.all([s.collection("ads").where("id","==",t.ad_id).get(),s.collection("makes").where("id","==",t.make_id).get(),s.collection("models").where("id","==",t.model_id).get()]).then(function(e){e[0].forEach(e=>{Object.assign(a,e.data())}),e[1].forEach(e=>{a.make=e.data().value}),e[2].forEach(e=>{a.model=e.data().modelvalue}),(""==i||i==a.make_id)&&(""==n||n==a.model_id)&&(""==o||o<=a.price)&&(""==d||d>=a.price)&&(""==c||c<=a.year)&&(""==r||r>=a.year)&&"true"==a.publish&&l.push(a)})}t.json(l)}t.upload=((e,t)=>{let a=e.files.file,n=i.extname(a.name),d=e.params.car_id;s.collection("cars").doc(d).get().then(e=>{let i=e.data(),c=i.imgincrement,r=d+"-"+ ++c+n,l=[];(l=JSON.parse(i.imgfiles)).push(r),o.existsSync("public")||o.mkdirSync("public",502,function(e){e&&(console.log(e),t.send("ERROR! Can't make the directory! \n"))}),o.existsSync("public/uploads")||o.mkdirSync("public/uploads",502,function(e){e&&(console.log(e),t.send("ERROR! Can't make the directory! \n"))}),o.existsSync("public/uploads/cars")||o.mkdirSync("public/uploads/cars",502,function(e){e&&(console.log(e),t.send("ERROR! Can't make the directory! \n"))}),a.mv("public/uploads/cars/"+r,function(e,a){let i={};return i.imgincrement=c,i.imgfiles=JSON.stringify(l),s.collection("cars").doc(d).update(i),t.json({success:!0,filename:r})})})}),t.create=((e,t)=>{let a={vehicle_id:e.body.vehicle_id,distance:e.body.distance,bodytype:e.body.bodytype,doors:e.body.doors,features:e.body.features,horsepower:e.body.horsepower,transmission:e.body.transmission,color:e.body.color,fueltype:e.body.fueltype,regionalspecs:e.body.regionalspecs,imgincrement:e.body.imgincrement,imgfiles:e.body.imgfiles,create_at:n.getDate(),update_at:n.getDate()},i=s.collection("cars").doc();a.id=i.id,i.set(a).then(e=>{t.json(a)}).catch(e=>t.status(500).json({message:e.message||"Something wrong while creating the car."}))}),t.findAll=(async(e,t)=>{let a=[];const i=await s.collection("cars").get();let n=[];i.forEach(function(e){n.push(e)});for(const e of n){let t=e.data(),i=t.id,n=await s.collection("vehicles").where("id","==",t.vehicle_id).get(),o=[];n.forEach(function(e){o.push(e)});for(const e of o){let n=e.data();Object.assign(t,n),await Promise.all([s.collection("ads").where("id","==",n.ad_id).get(),s.collection("makes").where("id","==",n.make_id).get(),s.collection("models").where("id","==",n.model_id).get()]).then(function(e){e[0].forEach(e=>{Object.assign(t,e.data())}),e[1].forEach(e=>{t.make=e.data().value}),e[2].forEach(e=>{t.model=e.data().modelvalue}),t.id=i,"true"==t.publish&&a.push(t)})}}t.json(a)}),t.findOne=(async(e,t)=>{let a;const i=await s.collection("cars").where("id","==",e.params.id).get();let n=[];i.forEach(function(e){n.push(e)});for(const e of n){a=e.data();let t=await s.collection("vehicles").where("id","==",a.vehicle_id).get(),i=[];t.forEach(function(e){i.push(e)});for(const e of i){let t=e.data();Object.assign(a,t),await Promise.all([s.collection("ads").where("id","==",t.ad_id).get(),s.collection("makes").where("id","==",t.make_id).get(),s.collection("models").where("id","==",t.model_id).get()]).then(function(e){e[0].forEach(e=>{Object.assign(a,e.data())}),e[1].forEach(e=>{a.make=e.data().value}),e[2].forEach(e=>{a.model=e.data().modelvalue})})}}t.json(a)}),t.findAloneOne=(async(e,t)=>{let a={};(await s.collection("cars").where("id","==",e.params.id).get()).forEach(function(e){a=e.data(),t.json(a)})}),t.findOneByAdId=(async(e,t)=>{let a={};const i=await s.collection("ads").where("id","==",e.params.id).get();let n=[];i.forEach(function(e){n.push(e)});for(const e of n){ad=e.data(),Object.assign(a,ad),a.ad_id=ad.id;let t=await s.collection("vehicles").where("ad_id","==",ad.id).get(),i=[];t.forEach(function(e){i.push(e)});for(const e of i){let t=e.data();Object.assign(a,t),a.vehicle_id=t.id,await Promise.all([s.collection("cars").where("vehicle_id","==",t.id).get(),s.collection("makes").where("id","==",t.make_id).get(),s.collection("models").where("id","==",t.model_id).get()]).then(function(e){e[0].forEach(e=>{Object.assign(a,e.data())}),e[1].forEach(e=>{a.make=e.data().value}),e[2].forEach(e=>{a.model=e.data().modelvalue})})}}t.json(a)}),t.findAllOnSearch=(async(e,t)=>{let a,i;switch(e.body.orderid){case"HIGHEST_PRICE":d(e,t,a=await s.collection("ads").orderBy("price","desc").get());break;case"LOWEST_PRICE":d(e,t,a=await s.collection("ads").orderBy("price","asc").get());break;case"NEWEST":c(e,t,i=await s.collection("vehicles").orderBy("year","desc").get());break;case"OLDEST":c(e,t,i=await s.collection("vehicles").orderBy("year","asc").get())}}),t.findAllOnIndex=(async(e,t)=>{let a=e.body.motor,i=e.body.make,n=e.body.model,o=Number(e.body.fromPrice),d=Number(e.body.toPrice),c=Number(e.body.fromYear),r=Number(e.body.toYear),l=[];const u=await s.collection(a).get();let m=[];u.forEach(function(e){m.push(e)});for(const e of m){let t=e.data(),a=t.id,u=await s.collection("vehicles").where("id","==",t.vehicle_id).get(),m=[];u.forEach(function(e){m.push(e)});for(const e of m){let u=e.data();Object.assign(t,u),await Promise.all([s.collection("ads").where("id","==",u.ad_id).get(),s.collection("makes").where("id","==",u.make_id).get(),s.collection("models").where("id","==",u.model_id).get()]).then(function(e){e[0].forEach(e=>{Object.assign(t,e.data())}),e[1].forEach(e=>{t.make=e.data().value}),e[2].forEach(e=>{t.model=e.data().modelvalue}),t.id=a,(""==i||i==t.make_id)&&(""==n||n==t.model_id)&&(""==o||o<=t.price)&&(""==d||d>=t.price)&&(""==c||c<=t.year)&&(""==r||r>=t.year)&&"true"==t.publish&&l.push(t)})}}t.json(l)}),t.update=((e,t)=>{if(e.params.id){let t={};t[e.body.fname]=e.body.fvalue,s.collection("cars").doc(e.params.id).update(t)}else{let e=s.collection("cars").doc();car.id=e.id,e.set(car)}}),t.updateImage=((e,t)=>{let a=e.params.id,i=e.body.imgFile,n="public/uploads/cars/"+i;o.unlinkSync(n,e=>{e&&console.error(e)}),s.collection("cars").doc(a).get().then(e=>{let n=e.data(),o=[];var d=(o=JSON.parse(n.imgfiles)).indexOf(i);d>-1&&o.splice(d,1),n.imgfiles=JSON.stringify(o),s.collection("cars").doc(a).update(n),t.send({message:"Car images updated successfully!",status:"Success"})})}),t.deleteByVehicleId=((e,t)=>{s.collection("cars").where("vehicle_id","==",e.params.id).get().then(a=>{if(!a)return t.status(404).send({message:"Car not found with id "+e.params.id});a.forEach(function(e){let a=e.data().id;e.ref.delete().then(e=>{t.send({message:"Car deleted successfully!",status:"Success",id:a})})})}).catch(a=>"ObjectId"===a.kind||"NotFound"===a.name?t.status(404).send({message:"Car not found with id "+e.params.id}):t.status(500).send({message:"Could not delete car with id "+e.params.id}))})},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t,a){e.exports=(e=>{const t=a(24);e.get("/makes",t.findAll),e.get("/makes/:id",t.findOne)})},function(e,t,a){var s=a(0).firestore();t.findAll=(async(e,t)=>{let a=[];(await s.collection("makes").get()).forEach(e=>{make=e.data(),a.push(make)}),t.json(a)}),t.findOne=(async(e,t)=>{(await s.collection("makes").where("id","==",e.params.id).get()).forEach(e=>{make=e.data(),t.json(make)})})},function(e,t,a){e.exports=(e=>{const t=a(26);e.get("/models",t.findAll),e.get("/models/:id",t.findOne),e.get("/models/makeid/:make_id",t.findAllByMakeId)})},function(e,t,a){var s=a(0).firestore();t.findAll=(async(e,t)=>{let a=[];(await s.collection("models").get()).forEach(e=>{model=e.data(),a.push(model)}),t.json(a)}),t.findOne=(async(e,t)=>{(await s.collection("models").where("id","==",e.params.id).get()).forEach(e=>{model=e.data(),t.json(model)})}),t.findAllByMakeId=(async(e,t)=>{let a=[];(await s.collection("models").where("make_id","==",e.params.make_id).get()).forEach(e=>{model=e.data(),a.push(model)}),t.json(a)})}]);